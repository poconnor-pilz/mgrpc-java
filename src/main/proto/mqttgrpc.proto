syntax = "proto3";

package com.pilz.mqttgrpc;

option java_multiple_files = true;
option java_package = "com.pilz.mqttgrpc";
option java_outer_classname = "MqttGrpc";

enum MqttGrpcType{
  //An error message
  ERROR = 0;
  //Request
  REQUEST = 1;
  //Next message in stream
  NEXT = 2;
  //Single message in stream
  SINGLE = 3;
  //Stream completed
  COMPLETED = 4;
}

message MqttGrpcRequest {
  //message type
  MqttGrpcType type = 1;
  //The message payload encoded as a protocol buffer
  bytes message = 2;
  //Topic to reply to. If this message is a request then replyTo must be set. Otherwise this message is part of a
  //is part of an input stream (client side stream)
  string replyTo = 3;
  //If this message is part of an input stream (client side stream) then streamId will contain a uuid that identifies it.
  string streamId = 4;
}

message MqttGrpcResponse {
  //Message type
  MqttGrpcType type = 1;
  //The message payload encoded as a protocol buffer
  bytes message = 2;
}

//The connection status of a server. Sent to an mqtt LWT topic
//When a service is connected it sends this message with connected = true
//Note that many of these messages may be sent (one for each service in a server) but they are idempotent.
//When a server is disconnected this message will automatically be sent as the topic for the connection status
//will be the LWT for the server.
message ConnectionStatus{
  bool connected = 1;
}

//A response containing the topic on which connection status will be sent
//The client will send an empty message to the serviceBaseTopic/connectionStatus and receive this response
//The client can then listen for ConnectionStatus messages at this topic.
message ConnectionStatusResponse{
  bool ok = 2;
  string connectionStatusTopic = 1;
  string errorMessage = 3;
}
